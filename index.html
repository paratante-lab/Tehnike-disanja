<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Breathing Exercises</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --card-bg: white;
            --primary-color: #3498db;
            --primary-dark: #2980b9;
            --secondary-color: #2c3e50;
            --accent-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --co2-color: #9b59b6;
            --border-color: #ddd;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg: #2d2d2d;
            --primary-color: #2980b9;
            --primary-dark: #3498db;
            --secondary-color: #4a90e2;
            --accent-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --co2-color: #8e44ad;
            --border-color: #404040;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Arial', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: var(--transition);
        }
        h1 {
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* HEADER SA DARK MODE I LANGUAGE TOGGLE */
        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .theme-toggle,
        .language-cycle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            background-color: var(--card-bg);
            border-radius: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid var(--primary-color);
            font-weight: 600;
            user-select: none;
        }

        .theme-toggle:hover,
        .language-cycle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background-color: var(--primary-color);
            color: white;
        }

        .theme-toggle:active,
        .language-cycle-btn:active {
            transform: translateY(0);
        }

        #current-lang-flag {
            font-size: 20px;
        }

        #current-lang-name {
            font-size: 14px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .language-cycle-btn:hover #current-lang-name {
            color: white;
        }
        
        .menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 30px;
        }
        button {
            padding: 12px;
            font-size: 16px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        button:hover {
            background-color: var(--primary-dark);
        }
        
        /* CO2 SPECIFIƒåNI GUMB */
        .co2-btn {
            background-color: var(--co2-color);
            position: relative;
            overflow: hidden;
        }
        
        .co2-btn:hover {
            background-color: #8e44ad;
        }
        
        .co2-btn::after {
            content: "üí®";
            position: absolute;
            right: 10px;
            font-size: 18px;
        }
        
        .exercise-container {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            display: none;
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }
        .active {
            display: block;
        }
        .timer {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: var(--text-color);
        }
        .cycle-counter {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            background-color: var(--card-bg);
            border-radius: 5px;
            border: 2px solid var(--primary-color);
            color: var(--secondary-color);
            transition: var(--transition);
        }
        .instructions {
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .benefits {
            background-color: rgba(52, 152, 219, 0.1);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--primary-color);
        }
        .benefits h3 {
            margin-top: 0;
            color: var(--secondary-color);
        }
        .benefits ul {
            padding-left: 20px;
        }
        .benefits li {
            margin-bottom: 5px;
        }
        .circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background-color: var(--danger-color);
            margin: 20px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 24px;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .progress-container {
            width: 100%;
            background-color: rgba(236, 240, 241, 0.3);
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        [data-theme="dark"] .progress-container {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .progress-bar {
            height: 20px;
            background-color: var(--accent-color);
            border-radius: 5px;
            width: 0%;
            transition: width 1s linear;
        }
        
        /* NOVI STILOVI ZA CO2 VJE≈ΩBU */
        .co2-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 25px 0;
        }
        
        .phase-control {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .phase-control h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--secondary-color);
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .phase-control h3 i {
            font-size: 20px;
        }
        
        .phase-control.inhale {
            border-left: 5px solid var(--accent-color);
        }
        
        .phase-control.exhale {
            border-left: 5px solid var(--danger-color);
        }
        
        .phase-control.hold {
            border-left: 5px solid var(--warning-color);
        }
        
        .phase-slider-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .phase-label {
            min-width: 120px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        .phase-slider {
            flex: 1;
            height: 25px;
            -webkit-appearance: none;
            background: rgba(236, 240, 241, 0.5);
            border-radius: 5px;
            outline: none;
        }
        
        .phase-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .phase-slider.inhale-slider::-webkit-slider-thumb {
            background: var(--accent-color);
        }
        
        .phase-slider.exhale-slider::-webkit-slider-thumb {
            background: var(--danger-color);
        }
        
        .phase-slider.hold-slider::-webkit-slider-thumb {
            background: var(--warning-color);
        }
        
        .phase-value {
            min-width: 50px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        /* NOVI STILOVI ZA GUMBIƒÜE + I - */
        .phase-adjust-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .adjust-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background-color: var(--primary-color);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .adjust-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .adjust-btn:active {
            transform: scale(0.95);
        }
        
        .adjust-btn.inhale-btn {
            background-color: var(--accent-color);
        }
        
        .adjust-btn.exhale-btn {
            background-color: var(--danger-color);
        }
        
        .adjust-btn.hold-btn {
            background-color: var(--warning-color);
        }
        
        .adjust-btn.minus-btn::after {
            content: "-";
        }
        
        .adjust-btn.plus-btn::after {
            content: "+";
        }
        
        .co2-settings-summary {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
            padding: 20px;
            background-color: rgba(155, 89, 182, 0.1);
            border-radius: 10px;
            border: 2px solid var(--co2-color);
        }
        
        .setting-item {
            text-align: center;
            padding: 10px 15px;
            background-color: var(--card-bg);
            border-radius: 8px;
            min-width: 150px;
        }
        
        .setting-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .setting-label {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
        }
        
        .inhale-value {
            color: var(--accent-color);
        }
        
        .exhale-value {
            color: var(--danger-color);
        }
        
        .hold-value {
            color: var(--warning-color);
        }
        
        .co2-phase-display {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--card-bg);
            border: 2px solid var(--co2-color);
            color: var(--co2-color);
        }
        
        .co2-cycle-display {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .co2-cycle-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--border-color);
            transition: var(--transition);
        }
        
        .co2-cycle-dot.active {
            background-color: var(--co2-color);
            transform: scale(1.2);
        }
        
        .co2-circle {
            background-color: var(--co2-color);
        }
        
        .co2-progress-bar {
            background-color: var(--co2-color);
        }
        
        /* WIM HOF KONTROLE */
        .wimhof-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .wimhof-controls button {
            padding: 12px 20px;
            font-size: 16px;
            min-width: 120px;
        }
        
        .wimhof-phase {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .breath-counter {
            font-size: 20px;
            text-align: center;
            margin: 10px 0;
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .hold-timer {
            font-size: 32px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            color: var(--danger-color);
        }
        
        .global-settings {
            background-color: var(--card-bg);
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        .global-settings h3 {
            margin-top: 0;
            color: var(--secondary-color);
        }
        .cycles-slider-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 10px;
        }
        .cycles-label {
            font-weight: bold;
            color: var(--secondary-color);
            min-width: 180px;
            text-align: right;
        }
        input[type="range"] {
            width: 200px;
            height: 25px;
            background: rgba(236, 240, 241, 0.5);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
            transition: var(--transition);
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            background: var(--primary-color);
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
        }
        
        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }
        
        .cycles-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--secondary-color);
            min-width: 40px;
            text-align: left;
            transition: var(--transition);
        }
        .cycles-info {
            font-size: 14px;
            color: var(--text-color);
            opacity: 0.8;
            margin-top: 10px;
            font-style: italic;
        }
        
        /* "POKRENI VJE≈ΩBU" GUMBI */
        .exercise-container button {
            width: 100%;
            padding: 16px;
            font-size: 18px;
            font-weight: bold;
            margin-top: 15px;
            background-color: var(--accent-color);
            border: none;
            border-radius: 8px;
            transition: var(--transition);
            box-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        
        .exercise-container button:hover {
            background-color: #219653;
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.15);
        }
        
        .exercise-container button:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .exercise-container button::after {
            content: " ‚ñ∂";
            margin-left: 8px;
            font-size: 16px;
        }
        
        /* CO2 START GUMB */
        .co2-start-btn {
            background-color: var(--co2-color);
        }
        
        .co2-start-btn:hover {
            background-color: #8e44ad;
        }
        
        /* ANIMACIJE */
        body {
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0.8; }
            to { opacity: 1; }
        }
        
        @media (max-width: 600px) {
            .menu {
                grid-template-columns: 1fr;
            }
            .cycles-slider-container {
                flex-direction: column;
                gap: 10px;
            }
            .cycles-label {
                text-align: center;
                min-width: auto;
            }
            input[type="range"] {
                width: 100%;
                max-width: 250px;
            }
            
            .phase-slider-container {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }
            
            .phase-label {
                min-width: auto;
            }
            
            .phase-adjust-buttons {
                justify-content: flex-start;
            }
            
            .co2-settings-summary {
                flex-direction: column;
                align-items: center;
            }
            
            .setting-item {
                width: 100%;
                max-width: 200px;
            }
            
            .wimhof-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .wimhof-controls button {
                width: 100%;
                max-width: 200px;
            }
            
            /* Veƒái gumbi na mobitelu */
            .exercise-container button {
                padding: 18px;
                font-size: 19px;
            }
            
            .circle {
                width: 180px;
                height: 180px;
                font-size: 22px;
            }
            
            .app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .header-controls {
                flex-direction: column;
                width: 100%;
            }
            
            .theme-toggle, .language-cycle-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body data-theme="light" data-lang="hr">
    <div class="app-header">
        <h1 id="app-title">üå¨Ô∏è Vje≈æbe disanja</h1>
        <div class="header-controls">
            <div class="language-cycle-btn" onclick="cycleLanguage()" role="button" aria-label="Promijeni jezik" tabindex="0">
                <span id="current-lang-flag" aria-hidden="true">üá≠üá∑</span>
                <span id="current-lang-name">HR</span>
            </div>
            <div class="theme-toggle" onclick="toggleTheme()" role="button" aria-label="Promijeni temu" tabindex="0">
                <span class="icon sun-icon" aria-hidden="true">‚òÄÔ∏è</span>
                <div class="toggle-slider" aria-hidden="true"></div>
                <span class="icon moon-icon" aria-hidden="true">üåô</span>
            </div>
        </div>
    </div>
    
    <!-- Globalno pode≈°avanje broja krugova -->
    <div class="global-settings">
        <h3 id="cycles-label">Broj krugova za sve vje≈æbe:</h3>
        <div class="cycles-slider-container">
            <span class="cycles-label" id="cycles-text">Broj krugova:</span>
            <input type="range" id="global-cycles" min="1" max="50" value="5" aria-label="Broj krugova">
            <span class="cycles-value" id="cycles-value">5</span>
        </div>
        <div class="cycles-info" id="cycles-info">
            <p>Ova postavka vrijedi za sve vje≈æbe. 1-15 krugova = poƒçetnik, 15-30 = srednji nivo, 30-50 = napredni.</p>
        </div>
    </div>
    
    <div class="menu">
        <button onclick="showExercise('deep')" id="btn-deep">Duboko disanje (4-7-8)</button>
        <button onclick="showExercise('box')" id="btn-box">Kvadratno disanje</button>
        <button onclick="showExercise('alternate')" id="btn-alternate">Alternativno disanje</button>
        <button onclick="showExercise('kapalabhati')" id="btn-kapalabhati">Kapalabhati</button>
        <button onclick="showExercise('wimhof')" id="btn-wimhof">Wim Hof</button>
        <button onclick="showExercise('co2')" class="co2-btn" id="btn-co2">CO2 Tolerancija</button>
    </div>
    
    <!-- DUBOKO DISANJE -->
    <div id="deep" class="exercise-container">
        <h2 id="deep-title">Duboko disanje (4-7-8)</h2>
        <div class="benefits">
            <h3 id="benefits-deep">Benefiti:</h3>
            <ul id="deep-benefits-list">
                <li>Smanjuje stres i anksioznost</li>
                <li>Poma≈æe kod nesanice</li>
                <li>Umiruje nervni sustav</li>
                <li>Pobolj≈°ava koncentraciju</li>
            </ul>
        </div>
        <div class="instructions">
            <p id="deep-step1">1. Udahni duboko kroz nos (4 sekunde)</p>
            <p id="deep-step2">2. Zadr≈æi dah (7 sekundi)</p>
            <p id="deep-step3">3. Izdah kroz usta (8 sekundi)</p>
            <p id="deep-repeat">Ponavljaj <span id="deep-cycle-count">5</span> puta.</p>
        </div>
        
        <div class="cycle-counter" id="deep-cycle-counter">Krug: 0/5</div>
        <div class="circle" id="deep-circle">SPREMAN</div>
        <div class="timer" id="deep-timer"></div>
        <div class="progress-container">
            <div class="progress-bar" id="deep-progress"></div>
        </div>
        <button onclick="startDeepBreathing()" id="btn-start-deep">Pokreni vje≈æbu</button>
    </div>
    
    <!-- KVADRATNO DISANJE -->
    <div id="box" class="exercise-container">
        <h2 id="box-title">Kvadratno disanje</h2>
        <div class="benefits">
            <h3 id="benefits-box">Benefiti:</h3>
            <ul id="box-benefits-list">
                <li>Balansira autonomni nervni sustav</li>
                <li>Smanjuje stres u trenutku</li>
                <li>Pobolj≈°ava fokus</li>
                <li>Koristi se u vojskama i sportu</li>
            </ul>
        </div>
        <div class="instructions">
            <p id="box-step1">1. Udahni (4 sekunde)</p>
            <p id="box-step2">2. Zadr≈æi dah (4 sekunde)</p>
            <p id="box-step3">3. Izdah (4 sekunde)</p>
            <p id="box-step4">4. Zadr≈æi prazna pluƒáa (4 sekunde)</p>
            <p id="box-repeat">Ponavljaj <span id="box-cycle-count">5</span> puta.</p>
        </div>
        
        <div class="cycle-counter" id="box-cycle-counter">Krug: 0/5</div>
        <div class="circle" id="box-circle">SPREMAN</div>
        <div class="timer" id="box-timer"></div>
        <div class="progress-container">
            <div class="progress-bar" id="box-progress"></div>
        </div>
        <button onclick="startBoxBreathing()" id="btn-start-box">Pokreni vje≈æbu</button>
    </div>
    
    <!-- ALTERNATIVNO DISANJE -->
    <div id="alternate" class="exercise-container">
        <h2 id="alternate-title">Alternativno disanje (Nadi Shodhana)</h2>
        <div class="benefits">
            <h3 id="benefits-alternate">Benefiti:</h3>
            <ul id="alternate-benefits-list">
                <li>Uravnote≈æuje lijevu i desnu mozgovnu hemisferu</li>
                <li>Pobolj≈°ava kognitivne funkcije</li>
                <li>Smanjuje mentalni nemir</li>
                <li>Poveƒáava svjesnost disanja</li>
            </ul>
        </div>
        <div class="instructions">
            <p id="alt-step1">1. Prstom zatvori desnu nosnicu</p>
            <p id="alt-step2">2. Udahni lijevom nosnicom (4 sekunde)</p>
            <p id="alt-step3">3. Zadr≈æi dah (4 sekunde)</p>
            <p id="alt-step4">4. Otvori desnu, zatvori lijevu nosnicu</p>
            <p id="alt-step5">5. Izdah desnom nosnicom (6 sekundi)</p>
            <p id="alt-repeat">Ponavljaj <span id="alt-cycle-count">5</span> puta.</p>
        </div>
        
        <div class="cycle-counter" id="alternate-cycle-counter">Krug: 0/5</div>
        <div class="circle" id="alternate-circle">SPREMAN</div>
        <div class="timer" id="alternate-timer"></div>
        <div class="progress-container">
            <div class="progress-bar" id="alternate-progress"></div>
        </div>
        <button onclick="startAlternateBreathing()" id="btn-start-alternate">Pokreni vje≈æbu</button>
    </div>

    <!-- KAPALABHATI -->
    <div id="kapalabhati" class="exercise-container">
        <h2 id="kapalabhati-title">Kapalabhati (Osvje≈æavajuƒáe disanje)</h2>
        <div class="benefits">
            <h3 id="benefits-kapalabhati">Benefiti:</h3>
            <ul id="kapalabhati-benefits-list">
                <li>Proƒçi≈°ƒáava pluƒáa i di≈°ne puteve</li>
                <li>Poveƒáava energiju i budnost</li>
                <li>Pobolj≈°ava probavu</li>
                <li>Jaƒça trbu≈°ne mi≈°iƒáe</li>
            </ul>
        </div>
        <div class="instructions">
            <p id="kap-step1">1. Udahni normalno kroz nos</p>
            <p id="kap-step2">2. Sna≈æno izdi≈°i kontrakcijom trbu≈°nih mi≈°iƒáa</p>
            <p id="kap-step3">3. Ponavljaj 30 brzih izdaha u 15 sekundi</p>
            <p id="kap-step4">4. Nakon serije, duboko udahni i zadr≈æi 15-30 sekundi</p>
            <p id="kap-repeat">5. Ponovi <span id="kap-cycle-count">5</span> serije</p>
        </div>
        
        <div class="cycle-counter" id="kapalabhati-cycle-counter">Krug: 0/5</div>
        <div class="circle" id="kapalabhati-circle">SPREMAN</div>
        <div class="timer" id="kapalabhati-timer"></div>
        <div class="progress-container">
            <div class="progress-bar" id="kapalabhati-progress"></div>
        </div>
        <button onclick="startKapalabhati()" id="btn-start-kapalabhati">Pokreni vje≈æbu</button>
    </div>

    <!-- WIM HOF -->
    <div id="wimhof" class="exercise-container">
        <h2 id="wimhof-title">Wim Hof metoda</h2>
        <div class="benefits">
            <h3 id="benefits-wimhof">Benefiti:</h3>
            <ul id="wimhof-benefits-list">
                <li>Poveƒáava energiju i imunitet</li>
                <li>Pobolj≈°ava kontrolu nad stresom</li>
                <li>Poveƒáava toleranciju na hladnoƒáu</li>
                <li>Pobolj≈°ava cirkulaciju</li>
            </ul>
        </div>
        <div class="instructions">
            <p id="wim-step1"><strong>Faza 1:</strong> 20-30 brzih udisaja i Izdaha u 60 sekundi</p>
            <p id="wim-step2"><strong>Faza 2:</strong> Izdah i zadr≈æavanje daha bez zraka (koliko god mo≈æe≈°), zatim pokreni iduƒáu fazu</p>
            <p id="wim-step3"><strong>Faza 3:</strong> Duboki udisaj i zadr≈æavanje daha 15 sekundi</p>
            <p id="wim-repeat">Ponovi ciklus <span id="wim-cycle-count">5</span> puta</p>
        </div>
        
        <div class="cycle-counter" id="wimhof-cycle-counter">Krug: 0/5</div>
        <div class="wimhof-phase" id="wimhof-phase">Priprema...</div>
        <div class="circle" id="wimhof-circle">SPREMAN</div>
        <div class="breath-counter" id="breath-counter" style="display: none;"><span id="breaths-text">Udisaji:</span> <span id="breath-count">0</span>/30</div>
        <div class="timer" id="wimhof-timer" style="display: none;"></div>
        <div class="hold-timer" id="hold-timer" style="display: none;">00:00</div>
        <div class="progress-container">
            <div class="progress-bar" id="wimhof-progress"></div>
        </div>
        
        <div class="wimhof-controls" id="wimhof-controls">
            <button onclick="startWimHofPhase1()" id="start-phase1">Pokreni Fazu 1</button>
            <button onclick="startWimHofPhase2()" id="start-phase2" style="display: none;">Zadr≈æi Dah (Faza 2)</button>
            <button onclick="startWimHofPhase3()" id="start-phase3" style="display: none;">Udahni i Zadr≈æi (Faza 3)</button>
        </div>
        
        <button onclick="resetWimHof()" style="background-color: var(--danger-color);" id="btn-reset-wimhof">Resetiraj Vje≈æbu</button>
    </div>

    <!-- CO‚ÇÇ TOLERANCIJA -->
    <div id="co2" class="exercise-container">
        <h2 id="co2-title">üí® CO‚ÇÇ Tolerancija (Kapno-metrijska vje≈æba)</h2>
        <div class="benefits">
            <h3 id="benefits-co2">Benefiti:</h3>
            <ul id="co2-benefits-list">
                <li>Poveƒáava toleranciju na CO‚ÇÇ u krvi</li>
                <li>Smanjuje osjeƒáaj zadihe i panike</li>
                <li>Pobolj≈°ava sportsku izdr≈æljivost</li>
                <li>Umiruje autonomni nervni sustav</li>
                <li>Smanjuje uƒçestalost disanja u mirovanju</li>
            </ul>
        </div>
        
        <div class="instructions">
            <p id="co2-instructions"><strong>Upute:</strong> Postavite trajanje svake faze prema va≈°oj trenutnoj toleranciji.</p>
            <p id="co2-tips">Poƒçnite s kraƒáim vrijednostima i postupno poveƒáavajte kako vam tolerancija raste.</p>
        </div>
        
        <!-- Kontrole za pode≈°avanje faze -->
        <div class="co2-controls">
            <!-- UDI≈†AJ -->
            <div class="phase-control inhale">
                <h3><i class="fas fa-wind" style="color: var(--accent-color);" aria-hidden="true"></i> <span id="inhale-label">1. Udah</span></h3>
                <!-- Gumbiƒái + i - -->
                <div class="phase-adjust-buttons">
                    <button class="adjust-btn inhale-btn minus-btn" onclick="adjustInhaleTime(-1)" aria-label="Smanji vrijeme udaha"></button>
                    <button class="adjust-btn inhale-btn plus-btn" onclick="adjustInhaleTime(1)" aria-label="Poveƒáaj vrijeme udaha"></button>
                </div>
                <div class="phase-slider-container">
                    <span class="phase-label" id="inhale-duration">Trajanje (sekunde):</span>
                    <input type="range" class="phase-slider inhale-slider" id="inhale-slider" min="2" max="20" value="4" aria-label="Vrijeme udaha">
                    <span class="phase-value inhale-value" id="inhale-value">4s</span>
                </div>
                <div style="font-size: 14px; color: var(--text-color); opacity: 0.8; margin-top: 8px;" id="inhale-desc">
                    Normalan udah kroz nos.
                </div>
            </div>
            
            <!-- IZDI≈†AJ -->
            <div class="phase-control exhale">
                <h3><i class="fas fa-wind" style="color: var(--danger-color);" aria-hidden="true"></i> <span id="exhale-label">2. Izdah</span></h3>
                <!-- Gumbiƒái + i - -->
                <div class="phase-adjust-buttons">
                    <button class="adjust-btn exhale-btn minus-btn" onclick="adjustExhaleTime(-1)" aria-label="Smanji vrijeme izdaha"></button>
                    <button class="adjust-btn exhale-btn plus-btn" onclick="adjustExhaleTime(1)" aria-label="Poveƒáaj vrijeme izdaha"></button>
                </div>
                <div class="phase-slider-container">
                    <span class="phase-label" id="exhale-duration">Trajanje (sekunde):</span>
                    <input type="range" class="phase-slider exhale-slider" id="exhale-slider" min="2" max="30" value="6" aria-label="Vrijeme izdaha">
                    <span class="phase-value exhale-value" id="exhale-value">6s</span>
                </div>
                <div style="font-size: 14px; color: var(--text-color); opacity: 0.8; margin-top: 8px;" id="exhale-desc">
                    Potpuni, kontrolirani izdah.
                </div>
            </div>
            
            <!-- ZADR≈ΩAVANJE -->
            <div class="phase-control hold">
                <h3><i class="fas fa-stopwatch" style="color: var(--warning-color);" aria-hidden="true"></i> <span id="hold-label">3. Zadr≈æavanje</span></h3>
                <!-- Gumbiƒái + i - -->
                <div class="phase-adjust-buttons">
                    <button class="adjust-btn hold-btn minus-btn" onclick="adjustHoldTime(-1)" aria-label="Smanji vrijeme zadr≈æavanja"></button>
                    <button class="adjust-btn hold-btn plus-btn" onclick="adjustHoldTime(1)" aria-label="Poveƒáaj vrijeme zadr≈æavanja"></button>
                </div>
                <div class="phase-slider-container">
                    <span class="phase-label" id="hold-duration">Trajanje (sekunde):</span>
                    <input type="range" class="phase-slider hold-slider" id="hold-slider" min="3" max="60" value="5" aria-label="Vrijeme zadr≈æavanja">
                    <span class="phase-value hold-value" id="hold-value">5s</span>
                </div>
                <div style="font-size: 14px; color: var(--text-color); opacity: 0.8; margin-top: 8px;" id="hold-desc">
                    Zadr≈æavanje daha bez udisanja.
                </div>
            </div>
        </div>
        
        <!-- Sa≈æetak postavki -->
        <div class="co2-settings-summary">
            <div class="setting-item">
                <div class="setting-value inhale-value" id="summary-inhale">4s</div>
                <div class="setting-label" id="summary-inhale-label">Dijafragmalni udah</div>
            </div>
            <div class="setting-item">
                <div class="setting-value exhale-value" id="summary-exhale">6s</div>
                <div class="setting-label" id="summary-exhale-label">Izdah</div>
            </div>
            <div class="setting-item">
                <div class="setting-value hold-value" id="summary-hold">5s</div>
                <div class="setting-label" id="summary-hold-label">Zadr≈æavanje</div>
            </div>
            <div class="setting-item">
                <div class="setting-value" id="co2-cycle-count" style="color: var(--co2-color);">5</div>
                <div class="setting-label" id="summary-cycles-label">Broj krugova</div>
            </div>
        </div>
        
        <!-- Brojaƒç krugova -->
        <div class="cycle-counter" id="co2-cycle-counter">
            Krug: 0/5
        </div>
        
        <!-- Prikaz trenutne faze -->
        <div class="co2-phase-display" id="co2-phase-display">
            Spremno za poƒçetak
        </div>
        
        <!-- Vizualni prikaz kruga -->
        <div class="co2-cycle-display" id="co2-cycle-display">
            <!-- Toƒçkice ƒáe se dinamiƒçki dodati -->
        </div>
        
        <!-- Timer i kru≈æni prikaz -->
        <div class="circle co2-circle" id="co2-circle">
            SPREMAN
        </div>
        
        <div class="timer" id="co2-timer"></div>
        
        <div class="progress-container">
            <div class="progress-bar co2-progress-bar" id="co2-progress"></div>
        </div>
        
        <!-- Gumb za pokretanje -->
        <button onclick="startCO2Exercise()" class="co2-start-btn">
            <i class="fas fa-play-circle" aria-hidden="true"></i> <span id="btn-start-co2">Pokreni CO2 vje≈æbu</span>
        </button>
    </div>

    <script>
        // ========== GLOBALNE VARIJABLE ==========
        let audioCtx = null;
        let audioInitialized = false;
        let globalCycles = 5;
        
        // CO2 varijable
        let co2InhaleTime = 4;
        let co2ExhaleTime = 6;
        let co2HoldTime = 5;
        let co2Round = 0;
        let co2Interval = null;
        let isCO2Running = false;
        
        // Wim Hof varijable
        let wimhofRound = 0;
        let wimhofPhase = 0;
        let breathCount = 0;
        let phase1Timer = null;
        let phase2StartTime = null;
        let phase2Timer = null;
        let phase3Timer = null;
        
        // Intervali za ostale vje≈æbe
        let activeIntervals = [];
        
        // ========== JEZIƒåNE POSTAVKE ==========
        const translations = {
            hr: {
                appTitle: "üå¨Ô∏è Vje≈æbe disanja",
                cyclesLabel: "Broj krugova za sve vje≈æbe:",
                cyclesText: "Broj krugova:",
                cyclesInfo: "Ova postavka vrijedi za sve vje≈æbe. 1-15 krugova = poƒçetnik, 15-30 = srednji nivo, 30-50 = napredni.",
                
                // Menu buttons
                btnDeep: "Duboko disanje (4-7-8)",
                btnBox: "Kvadratno disanje",
                btnAlternate: "Alternativno disanje",
                btnKapalabhati: "Kapalabhati",
                btnWimhof: "Wim Hof",
                btnCO2: "CO2 Tolerancija",
                
                // Deep Breathing
                deepTitle: "Duboko disanje (4-7-8)",
                benefitsDeep: "Benefiti:",
                deepBenefitsList: [
                    "Smanjuje stres i anksioznost",
                    "Poma≈æe kod nesanice",
                    "Umiruje nervni sustav",
                    "Pobolj≈°ava koncentraciju"
                ],
                deepStep1: "1. Udahni duboko kroz nos (4 sekunde)",
                deepStep2: "2. Zadr≈æi dah (7 sekundi)",
                deepStep3: "3. Izdah kroz usta (8 sekundi)",
                deepRepeat: "Ponavljaj",
                times: "puta.",
                btnStartDeep: "Pokreni vje≈æbu",
                
                // Box Breathing
                boxTitle: "Kvadratno disanje",
                benefitsBox: "Benefiti:",
                boxBenefitsList: [
                    "Balansira autonomni nervni sustav",
                    "Smanjuje stres u trenutku",
                    "Pobolj≈°ava fokus",
                    "Koristi se u vojskama i sportu"
                ],
                boxStep1: "1. Udahni (4 sekunde)",
                boxStep2: "2. Zadr≈æi dah (4 sekunde)",
                boxStep3: "3. Izdah (4 sekunde)",
                boxStep4: "4. Zadr≈æi prazna pluƒáa (4 sekunde)",
                boxRepeat: "Ponavljaj",
                btnStartBox: "Pokreni vje≈æbu",
                
                // Alternate Breathing
                alternateTitle: "Alternativno disanje (Nadi Shodhana)",
                benefitsAlternate: "Benefiti:",
                alternateBenefitsList: [
                    "Uravnote≈æuje lijevu i desnu mozgovnu hemisferu",
                    "Pobolj≈°ava kognitivne funkcije",
                    "Smanjuje mentalni nemir",
                    "Poveƒáava svjesnost disanja"
                ],
                altStep1: "1. Prstom zatvori desnu nosnicu",
                altStep2: "2. Udahni lijevom nosnicom (4 sekunde)",
                altStep3: "3. Zadr≈æi dah (4 sekunde)",
                altStep4: "4. Otvori desnu, zatvori lijevu nosnicu",
                altStep5: "5. Izdah desnom nosnicom (6 sekundi)",
                altRepeat: "Ponavljaj",
                btnStartAlternate: "Pokreni vje≈æbu",
                
                // Kapalabhati
                kapalabhatiTitle: "Kapalabhati (Osvje≈æavajuƒáe disanje)",
                benefitsKapalabhati: "Benefiti:",
                kapalabhatiBenefitsList: [
                    "Proƒçi≈°ƒáava pluƒáa i di≈°ne puteve",
                    "Poveƒáava energiju i budnost",
                    "Pobolj≈°ava probavu",
                    "Jaƒça trbu≈°ne mi≈°iƒáe"
                ],
                kapStep1: "1. Udahni normalno kroz nos",
                kapStep2: "2. Sna≈æno izdi≈°i kontrakcijom trbu≈°nih mi≈°iƒáa",
                kapStep3: "3. Ponavljaj 30 brzih izdaha u 15 sekundi",
                kapStep4: "4. Nakon serije, duboko udahni i zadr≈æi 15-30 sekundi",
                kapRepeat: "5. Ponovi",
                series: "serije",
                btnStartKapalabhati: "Pokreni vje≈æbu",
                
                // Wim Hof
                wimhofTitle: "Wim Hof metoda",
                benefitsWimhof: "Benefiti:",
                wimhofBenefitsList: [
                    "Poveƒáava energiju i imunitet",
                    "Pobolj≈°ava kontrolu nad stresom",
                    "Poveƒáava toleranciju na hladnoƒáu",
                    "Pobolj≈°ava cirkulaciju"
                ],
                wimStep1: "Faza 1: 20-30 brzih udisaja i Izdaha u 60 sekundi",
                wimStep2: "Faza 2: Izdah i zadr≈æavanje daha bez zraka (koliko god mo≈æe≈°), zatim pokreni iduƒáu fazu",
                wimStep3: "Faza 3: Duboki udisaj i zadr≈æavanje daha 15 sekundi",
                wimRepeat: "Ponovi ciklus",
                breathsText: "Udisaji:",
                btnStartPhase1: "Pokreni Fazu 1",
                btnStartPhase2: "Zadr≈æi Dah (Faza 2)",
                btnStartPhase3: "Udahni i Zadr≈æi (Faza 3)",
                btnResetWimhof: "Resetiraj Vje≈æbu",
                
                // CO2 Tolerance
                co2Title: "üí® CO‚ÇÇ Tolerancija (Kapno-metrijska vje≈æba)",
                benefitsCO2: "Benefiti:",
                co2BenefitsList: [
                    "Poveƒáava toleranciju na CO‚ÇÇ u krvi",
                    "Smanjuje osjeƒáaj zadihe i panike",
                    "Pobolj≈°ava sportsku izdr≈æljivost",
                    "Umiruje autonomni nervni sustav",
                    "Smanjuje uƒçestalost disanja u mirovanju"
                ],
                co2Instructions: "Upute: Postavite trajanje svake faze prema va≈°oj trenutnoj toleranciji.",
                co2Tips: "Poƒçnite s kraƒáim vrijednostima i postupno poveƒáavajte kako vam tolerancija raste.",
                inhaleLabel: "1. Udah",
                exhaleLabel: "2. Izdah",
                holdLabel: "3. Zadr≈æavanje",
                inhaleDuration: "Trajanje (sekunde):",
                exhaleDuration: "Trajanje (sekunde):",
                holdDuration: "Trajanje (sekunde):",
                inhaleDesc: "Normalan udah kroz nos.",
                exhaleDesc: "Potpuni, kontrolirani izdah.",
                holdDesc: "Zadr≈æavanje daha bez udisanja.",
                summaryInhaleLabel: "Dijafragmalni udah",
                summaryExhaleLabel: "Izdah",
                summaryHoldLabel: "Zadr≈æavanje",
                summaryCyclesLabel: "Broj krugova",
                btnStartCO2: "Pokreni CO2 vje≈æbu",
                
                // UI Texts
                ready: "SPREMAN",
                done: "GOTOVO",
                inhale: "UDI≈†I",
                hold: "ZADR≈ΩI",
                exhale: "IZDI≈†I",
                pause: "PAUZA",
                round: "Krug",
                seriesCount: "Serija",
                cycle: "Krug:",
                roundText: "Krug",
                fastBreathing: "BRZO DISANJE",
                breatheLeft: "UDI≈†I LIJEVOM",
                breatheRight: "IZDI≈†I DESNOM",
                holdEmpty: "ZADR≈ΩI PRAZNA PLUƒÜA",
                preparation: "Priprema...",
                start: "Poƒçetak...",
                getReady: "Spremno za poƒçetak",
                exerciseComplete: "Vje≈æba zavr≈°ena!",
                exerciseStopped: "Vje≈æba zaustavljena",
                rest: "Odmorite se."
            },
            en: {
                appTitle: "üå¨Ô∏è Breathing Exercises",
                cyclesLabel: "Number of cycles for all exercises:",
                cyclesText: "Number of cycles:",
                cyclesInfo: "This setting applies to all exercises. 1-15 cycles = beginner, 15-30 = intermediate, 30-50 = advanced.",
                
                // Menu buttons
                btnDeep: "Deep Breathing (4-7-8)",
                btnBox: "Box Breathing",
                btnAlternate: "Alternate Nostril Breathing",
                btnKapalabhati: "Kapalabhati",
                btnWimhof: "Wim Hof Method",
                btnCO2: "CO‚ÇÇ Tolerance",
                
                // Deep Breathing
                deepTitle: "Deep Breathing (4-7-8)",
                benefitsDeep: "Benefits:",
                deepBenefitsList: [
                    "Reduces stress and anxiety",
                    "Helps with insomnia",
                    "Calms the nervous system",
                    "Improves concentration"
                ],
                deepStep1: "1. Inhale deeply through nose (4 seconds)",
                deepStep2: "2. Hold breath (7 seconds)",
                deepStep3: "3. Exhale through mouth (8 seconds)",
                deepRepeat: "Repeat",
                times: "times.",
                btnStartDeep: "Start Exercise",
                
                // Box Breathing
                boxTitle: "Box Breathing",
                benefitsBox: "Benefits:",
                boxBenefitsList: [
                    "Balances autonomic nervous system",
                    "Reduces immediate stress",
                    "Improves focus",
                    "Used in military and sports"
                ],
                boxStep1: "1. Inhale (4 seconds)",
                boxStep2: "2. Hold breath (4 seconds)",
                boxStep3: "3. Exhale (4 seconds)",
                boxStep4: "4. Hold with empty lungs (4 seconds)",
                boxRepeat: "Repeat",
                btnStartBox: "Start Exercise",
                
                // Alternate Breathing
                alternateTitle: "Alternate Nostril Breathing (Nadi Shodhana)",
                benefitsAlternate: "Benefits:",
                alternateBenefitsList: [
                    "Balances left and right brain hemispheres",
                    "Improves cognitive functions",
                    "Reduces mental restlessness",
                    "Increases breathing awareness"
                ],
                altStep1: "1. Close right nostril with finger",
                altStep2: "2. Inhale through left nostril (4 seconds)",
                altStep3: "3. Hold breath (4 seconds)",
                altStep4: "4. Open right, close left nostril",
                altStep5: "5. Exhale through right nostril (6 seconds)",
                altRepeat: "Repeat",
                btnStartAlternate: "Start Exercise",
                
                // Kapalabhati
                kapalabhatiTitle: "Kapalabhati (Skull Shining Breath)",
                benefitsKapalabhati: "Benefits:",
                kapalabhatiBenefitsList: [
                    "Cleanses lungs and respiratory tract",
                    "Increases energy and alertness",
                    "Improves digestion",
                    "Strengthens abdominal muscles"
                ],
                kapStep1: "1. Inhale normally through nose",
                kapStep2: "2. Exhale forcefully with abdominal contraction",
                kapStep3: "3. Repeat 30 quick exhalations in 15 seconds",
                kapStep4: "4. After series, inhale deeply and hold 15-30 seconds",
                kapRepeat: "5. Repeat",
                series: "series",
                btnStartKapalabhati: "Start Exercise",
                
                // Wim Hof
                wimhofTitle: "Wim Hof Method",
                benefitsWimhof: "Benefits:",
                wimhofBenefitsList: [
                    "Increases energy and immunity",
                    "Improves stress control",
                    "Increases cold tolerance",
                    "Improves circulation"
                ],
                wimStep1: "Phase 1: 20-30 rapid inhalations and exhalations in 60 seconds",
                wimStep2: "Phase 2: Exhale and hold breath without air (as long as you can), then start next phase",
                wimStep3: "Phase 3: Deep inhalation and hold breath for 15 seconds",
                wimRepeat: "Repeat cycle",
                breathsText: "Breaths:",
                btnStartPhase1: "Start Phase 1",
                btnStartPhase2: "Hold Breath (Phase 2)",
                btnStartPhase3: "Inhale and Hold (Phase 3)",
                btnResetWimhof: "Reset Exercise",
                
                // CO2 Tolerance
                co2Title: "üí® CO‚ÇÇ Tolerance (Capnometric Exercise)",
                benefitsCO2: "Benefits:",
                co2BenefitsList: [
                    "Increases tolerance to CO‚ÇÇ in blood",
                    "Reduces feeling of breathlessness and panic",
                    "Improves athletic endurance",
                    "Calms autonomic nervous system",
                    "Reduces breathing frequency at rest"
                ],
                co2Instructions: "Instructions: Set duration of each phase according to your current tolerance.",
                co2Tips: "Start with shorter values and gradually increase as your tolerance grows.",
                inhaleLabel: "1. Inhale",
                exhaleLabel: "2. Exhale",
                holdLabel: "3. Retention",
                inhaleDuration: "Duration (seconds):",
                exhaleDuration: "Duration (seconds):",
                holdDuration: "Duration (seconds):",
                inhaleDesc: "Normal inhalation through nose.",
                exhaleDesc: "Complete, controlled exhalation.",
                holdDesc: "Breath retention without inhaling.",
                summaryInhaleLabel: "Diaphragmatic inhalation",
                summaryExhaleLabel: "Exhalation",
                summaryHoldLabel: "Retention",
                summaryCyclesLabel: "Number of cycles",
                btnStartCO2: "Start CO‚ÇÇ Exercise",
                
                // UI Texts
                ready: "READY",
                done: "DONE",
                inhale: "INHALE",
                hold: "HOLD",
                exhale: "EXHALE",
                pause: "PAUSE",
                round: "Round",
                seriesCount: "Series",
                cycle: "Round:",
                roundText: "Round",
                fastBreathing: "FAST BREATHING",
                breatheLeft: "INHALE LEFT",
                breatheRight: "EXHALE RIGHT",
                holdEmpty: "HOLD EMPTY LUNGS",
                preparation: "Preparation...",
                start: "Start...",
                getReady: "Ready to start",
                exerciseComplete: "Exercise complete!",
                exerciseStopped: "Exercise stopped",
                rest: "Rest."
            },
            de: {
                appTitle: "üå¨Ô∏è Atem√ºbungen",
                cyclesLabel: "Anzahl der Zyklen f√ºr alle √úbungen:",
                cyclesText: "Anzahl der Zyklen:",
                cyclesInfo: "Diese Einstellung gilt f√ºr alle √úbungen. 1-15 Zyklen = Anf√§nger, 15-30 = Mittelstufe, 30-50 = Fortgeschritten.",
                
                // Menu buttons
                btnDeep: "Tiefes Atmen (4-7-8)",
                btnBox: "Box-Atmung",
                btnAlternate: "Wechselatmung",
                btnKapalabhati: "Kapalabhati",
                btnWimhof: "Wim Hof Methode",
                btnCO2: "CO‚ÇÇ Toleranz",
                
                // Deep Breathing
                deepTitle: "Tiefes Atmen (4-7-8)",
                benefitsDeep: "Vorteile:",
                deepBenefitsList: [
                    "Reduziert Stress und Angst",
                    "Hilft bei Schlaflosigkeit",
                    "Beruhigt das Nervensystem",
                    "Verbessert die Konzentration"
                ],
                deepStep1: "1. Tief durch die Nase einatmen (4 Sekunden)",
                deepStep2: "2. Atem anhalten (7 Sekunden)",
                deepStep3: "3. Durch den Mund ausatmen (8 Sekunden)",
                deepRepeat: "Wiederhole",
                times: "mal.",
                btnStartDeep: "√úbung starten",
                
                // Box Breathing
                boxTitle: "Box-Atmung",
                benefitsBox: "Vorteile:",
                boxBenefitsList: [
                    "Balanciert das autonome Nervensystem",
                    "Reduziert sofortigen Stress",
                    "Verbessert den Fokus",
                    "Wird im Milit√§r und Sport verwendet"
                ],
                boxStep1: "1. Einatmen (4 Sekunden)",
                boxStep2: "2. Atem anhalten (4 Sekunden)",
                boxStep3: "3. Ausatmen (4 Sekunden)",
                boxStep4: "4. Mit leeren Lungen halten (4 Sekunden)",
                boxRepeat: "Wiederhole",
                btnStartBox: "√úbung starten",
                
                // Alternate Breathing
                alternateTitle: "Wechselatmung (Nadi Shodhana)",
                benefitsAlternate: "Vorteile:",
                alternateBenefitsList: [
                    "Balanciert linke und rechte Gehirnh√§lften",
                    "Verbessert kognitive Funktionen",
                    "Reduziert geistige Unruhe",
                    "Erh√∂ht die Atemwahrnehmung"
                ],
                altStep1: "1. Rechtes Nasenloch mit Finger schlie√üen",
                altStep2: "2. Durch linkes Nasenloch einatmen (4 Sekunden)",
                altStep3: "3. Atem anhalten (4 Sekunden)",
                altStep4: "4. Rechtes √∂ffnen, linkes schlie√üen",
                altStep5: "5. Durch rechtes Nasenloch ausatmen (6 Sekunden)",
                altRepeat: "Wiederhole",
                btnStartAlternate: "√úbung starten",
                
                // Kapalabhati
                kapalabhatiTitle: "Kapalabhati (Erfrischende Atmung)",
                benefitsKapalabhati: "Vorteile:",
                kapalabhatiBenefitsList: [
                    "Reinigt Lungen und Atemwege",
                    "Erh√∂ht Energie und Wachsamkeit",
                    "Verbessert die Verdauung",
                    "St√§rkt Bauchmuskeln"
                ],
                kapStep1: "1. Normal durch die Nase einatmen",
                kapStep2: "2. Kraftvoll mit Bauchkontraktion ausatmen",
                kapStep3: "3. 30 schnelle Ausatmungen in 15 Sekunden wiederholen",
                kapStep4: "4. Nach der Serie tief einatmen und 15-30 Sekunden halten",
                kapRepeat: "5. Wiederhole",
                series: "Serien",
                btnStartKapalabhati: "√úbung starten",
                
                // Wim Hof
                wimhofTitle: "Wim Hof Methode",
                benefitsWimhof: "Vorteile:",
                wimhofBenefitsList: [
                    "Erh√∂ht Energie und Immunit√§t",
                    "Verbessert Stresskontrolle",
                    "Erh√∂ht K√§ltetoleranz",
                    "Verbessert die Durchblutung"
                ],
                wimStep1: "Phase 1: 20-30 schnelle Ein- und Ausatmungen in 60 Sekunden",
                wimStep2: "Phase 2: Ausatmen und Atem ohne Luft anhalten (so lange wie m√∂glich), dann n√§chste Phase starten",
                wimStep3: "Phase 3: Tiefes Einatmen und Atem 15 Sekunden anhalten",
                wimRepeat: "Zyklen wiederholen",
                breathsText: "Atemz√ºge:",
                btnStartPhase1: "Phase 1 starten",
                btnStartPhase2: "Atem anhalten (Phase 2)",
                btnStartPhase3: "Einatmen und Halten (Phase 3)",
                btnResetWimhof: "√úbung zur√ºcksetzen",
                
                // CO2 Tolerance
                co2Title: "üí® CO‚ÇÇ Toleranz (Kapnometrische √úbung)",
                benefitsCO2: "Vorteile:",
                co2BenefitsList: [
                    "Erh√∂ht Toleranz gegen√ºber CO‚ÇÇ im Blut",
                    "Reduziert Atemnot- und Panikgef√ºhl",
                    "Verbessert sportliche Ausdauer",
                    "Beruhigt das autonome Nervensystem",
                    "Reduziert Atemfrequenz in Ruhe"
                ],
                co2Instructions: "Anleitung: Stellen Sie die Dauer jeder Phase gem√§√ü Ihrer aktuellen Toleranz ein.",
                co2Tips: "Beginnen Sie mit k√ºrzeren Werten und erh√∂hen Sie diese schrittweise, w√§hrend Ihre Toleranz w√§chst.",
                inhaleLabel: "1. Einatmen",
                exhaleLabel: "2. Ausatmen",
                holdLabel: "3. Anhalten",
                inhaleDuration: "Dauer (Sekunden):",
                exhaleDuration: "Dauer (Sekunden):",
                holdDuration: "Dauer (Sekunden):",
                inhaleDesc: "Normales Einatmen durch die Nase.",
                exhaleDesc: "Vollst√§ndiges, kontrolliertes Ausatmen.",
                holdDesc: "Atemanhalt ohne Einatmen.",
                summaryInhaleLabel: "Zwerchfell-Atmung",
                summaryExhaleLabel: "Ausatmen",
                summaryHoldLabel: "Anhalten",
                summaryCyclesLabel: "Anzahl Zyklen",
                btnStartCO2: "CO‚ÇÇ √úbung starten",
                
                // UI Texts
                ready: "BEREIT",
                done: "FERTIG",
                inhale: "EINATMEN",
                hold: "HALTEN",
                exhale: "AUSATMEN",
                pause: "PAUSE",
                round: "Runde",
                seriesCount: "Serie",
                cycle: "Runde:",
                roundText: "Runde",
                fastBreathing: "SCHNELL ATMEN",
                breatheLeft: "LINKS EINATMEN",
                breatheRight: "RECHTS AUSATMEN",
                holdEmpty: "LEERE LUNGEN HALTEN",
                preparation: "Vorbereitung...",
                start: "Start...",
                getReady: "Bereit zum Start",
                exerciseComplete: "√úbung beendet!",
                exerciseStopped: "√úbung gestoppt",
                rest: "Ausruhen."
            },
            es: {
                appTitle: "üå¨Ô∏è Ejercicios de Respiraci√≥n",
                cyclesLabel: "N√∫mero de ciclos para todos los ejercicios:",
                cyclesText: "N√∫mero de ciclos:",
                cyclesInfo: "Esta configuraci√≥n se aplica a todos los ejercicios. 1-15 ciclos = principiante, 15-30 = intermedio, 30-50 = avanzado.",
                
                // Menu buttons
                btnDeep: "Respiraci√≥n Profunda (4-7-8)",
                btnBox: "Respiraci√≥n Cuadrada",
                btnAlternate: "Respiraci√≥n Alterna",
                btnKapalabhati: "Kapalabhati",
                btnWimhof: "M√©todo Wim Hof",
                btnCO2: "Tolerancia CO‚ÇÇ",
                
                // Deep Breathing
                deepTitle: "Respiraci√≥n Profunda (4-7-8)",
                benefitsDeep: "Beneficios:",
                deepBenefitsList: [
                    "Reduce estr√©s y ansiedad",
                    "Ayuda con el insomnio",
                    "Calma el sistema nervioso",
                    "Mejora la concentraci√≥n"
                ],
                deepStep1: "1. Inhala profundamente por la nariz (4 segundos)",
                deepStep2: "2. Ret√©n la respiraci√≥n (7 segundos)",
                deepStep3: "3. Exhala por la boca (8 segundos)",
                deepRepeat: "Repite",
                times: "veces.",
                btnStartDeep: "Iniciar Ejercicio",
                
                // Box Breathing
                boxTitle: "Respiraci√≥n Cuadrada",
                benefitsBox: "Beneficios:",
                boxBenefitsList: [
                    "Equilibra el sistema nervioso aut√≥nomo",
                    "Reduce el estr√©s inmediato",
                    "Mejora el enfoque",
                    "Usado en militares y deportes"
                ],
                boxStep1: "1. Inhala (4 segundos)",
                boxStep2: "2. Ret√©n la respiraci√≥n (4 segundos)",
                boxStep3: "3. Exhala (4 segundos)",
                boxStep4: "4. Ret√©n con pulmones vac√≠os (4 segundos)",
                boxRepeat: "Repite",
                btnStartBox: "Iniciar Ejercicio",
                
                // Alternate Breathing
                alternateTitle: "Respiraci√≥n Alterna (Nadi Shodhana)",
                benefitsAlternate: "Beneficios:",
                alternateBenefitsList: [
                    "Equilibra hemisferios cerebrales izquierdo y derecho",
                    "Mejora funciones cognitivas",
                    "Reduce inquietud mental",
                    "Aumenta conciencia respiratoria"
                ],
                altStep1: "1. Cierra fosa nasal derecha con dedo",
                altStep2: "2. Inhala por fosa nasal izquierda (4 segundos)",
                altStep3: "3. Ret√©n la respiraci√≥n (4 segundos)",
                altStep4: "4. Abre derecha, cierra izquierda",
                altStep5: "5. Exhala por fosa nasal derecha (6 segundos)",
                altRepeat: "Repite",
                btnStartAlternate: "Iniciar Ejercicio",
                
                // Kapalabhati
                kapalabhatiTitle: "Kapalabhati (Respiraci√≥n Refrescante)",
                benefitsKapalabhati: "Beneficios:",
                kapalabhatiBenefitsList: [
                    "Limpia pulmones y v√≠as respiratorias",
                    "Aumenta energ√≠a y alerta",
                    "Mejora digesti√≥n",
                    "Fortalece m√∫sculos abdominales"
                ],
                kapStep1: "1. Inhala normalmente por nariz",
                kapStep2: "2. Exhala con fuerza con contracci√≥n abdominal",
                kapStep3: "3. Repite 30 exhalaciones r√°pidas en 15 segundos",
                kapStep4: "4. Despu√©s de serie, inhala profundamente y ret√©n 15-30 segundos",
                kapRepeat: "5. Repite",
                series: "series",
                btnStartKapalabhati: "Iniciar Ejercicio",
                
                // Wim Hof
                wimhofTitle: "M√©todo Wim Hof",
                benefitsWimhof: "Beneficios:",
                wimhofBenefitsList: [
                    "Aumenta energ√≠a e inmunidad",
                    "Mejora control del estr√©s",
                    "Aumenta tolerancia al fr√≠o",
                    "Mejora circulaci√≥n"
                ],
                wimStep1: "Fase 1: 20-30 inhalaciones y exhalaciones r√°pidas en 60 segundos",
                wimStep2: "Fase 2: Exhala y ret√©n respiraci√≥n sin aire (todo lo que puedas), luego inicia fase siguiente",
                wimStep3: "Fase 3: Inhalaci√≥n profunda y ret√©n respiraci√≥n 15 segundos",
                wimRepeat: "Repite ciclo",
                breathsText: "Respiraciones:",
                btnStartPhase1: "Iniciar Fase 1",
                btnStartPhase2: "Retener Respiraci√≥n (Fase 2)",
                btnStartPhase3: "Inhalar y Retener (Fase 3)",
                btnResetWimhof: "Reiniciar Ejercicio",
                
                // CO2 Tolerance
                co2Title: "üí® Tolerancia CO‚ÇÇ (Ejercicio Capnom√©trico)",
                benefitsCO2: "Beneficios:",
                co2BenefitsList: [
                    "Aumenta tolerancia a CO‚ÇÇ en sangre",
                    "Reduce sensaci√≥n de ahogo y p√°nico",
                    "Mejora resistencia atl√©tica",
                    "Calma sistema nervioso aut√≥nomo",
                    "Reduce frecuencia respiratoria en reposo"
                ],
                co2Instructions: "Instrucciones: Configure la duraci√≥n de cada fase seg√∫n su tolerancia actual.",
                co2Tips: "Comience con valores m√°s cortos y aumente gradualmente a medida que crece su tolerancia.",
                inhaleLabel: "1. Inhalar",
                exhaleLabel: "2. Exhalar",
                holdLabel: "3. Retenci√≥n",
                inhaleDuration: "Duraci√≥n (segundos):",
                exhaleDuration: "Duraci√≥n (segundos):",
                holdDuration: "Duraci√≥n (segundos):",
                inhaleDesc: "Inhalaci√≥n normal por nariz.",
                exhaleDesc: "Exhalaci√≥n completa y controlada.",
                holdDesc: "Retenci√≥n de respiraci√≥n sin inhalar.",
                summaryInhaleLabel: "Inhalaci√≥n diafragm√°tica",
                summaryExhaleLabel: "Exhalaci√≥n",
                summaryHoldLabel: "Retenci√≥n",
                summaryCyclesLabel: "N√∫mero de ciclos",
                btnStartCO2: "Iniciar Ejercicio CO‚ÇÇ",
                
                // UI Texts
                ready: "LISTO",
                done: "TERMINADO",
                inhale: "INHALAR",
                hold: "RETENER",
                exhale: "EXHALAR",
                pause: "PAUSA",
                round: "Ronda",
                seriesCount: "Serie",
                cycle: "Ronda:",
                roundText: "Ronda",
                fastBreathing: "RESPIRACI√ìN R√ÅPIDA",
                breatheLeft: "INHALAR IZQUIERDA",
                breatheRight: "EXHALAR DERECHA",
                holdEmpty: "RETENER PULMONES VAC√çOS",
                preparation: "Preparando...",
                start: "Comenzando...",
                getReady: "Listo para comenzar",
                exerciseComplete: "¬°Ejercicio completado!",
                exerciseStopped: "Ejercicio detenido",
                rest: "Descansar."
            }
        };

        // ========== POMOƒÜNE FUNKCIJE ==========
        
        // Audio kontekst s odgoƒëenom inicijalizacijom
        function getAudioContext() {
            if (!audioCtx) {
                try {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    audioInitialized = true;
                } catch (e) {
                    console.log("Web Audio API nije podr≈æan u ovom pregledniku");
                    return null;
                }
            }
            return audioCtx;
        }

        // Funkcija za reprodukciju beep zvuka
        function playBeep(duration = 200, frequency = 800, type = "sine") {
            // Inicijaliziraj AudioContext samo nakon korisniƒçke interakcije
            if (!audioInitialized) {
                // Poku≈°aj inicijalizirati na prvi klik
                getAudioContext();
                return;
            }
            
            const ctx = getAudioContext();
            if (!ctx) return;
            
            try {
                // Ako je AudioContext suspendiran (jer preglednici blokiraju audio prije interakcije)
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }
                
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                gainNode.gain.setValueAtTime(0.5, ctx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration/1000);
                
                oscillator.start();
                oscillator.stop(ctx.currentTime + duration/1000);
            } catch (e) {
                console.log("Gre≈°ka pri reprodukciji zvuka:", e);
            }
        }

        // Funkcija za ƒçi≈°ƒáenje svih intervala
        function clearAllIntervals() {
            // Oƒçisti CO2 interval
            if (co2Interval) {
                clearInterval(co2Interval);
                co2Interval = null;
            }
            
            // Oƒçisti Wim Hof timere
            if (phase1Timer) {
                clearInterval(phase1Timer);
                phase1Timer = null;
            }
            if (phase2Timer) {
                clearInterval(phase2Timer);
                phase2Timer = null;
            }
            if (phase3Timer) {
                clearTimeout(phase3Timer);
                phase3Timer = null;
            }
            
            // Oƒçisti ostale intervale
            activeIntervals.forEach(interval => {
                clearInterval(interval);
            });
            activeIntervals = [];
        }

        // Funkcija za zaustavljanje svih vje≈æbi
        function stopAllExercises() {
            clearAllIntervals();
            
            // Zaustavi CO2 vje≈æbu
            if (isCO2Running) {
                isCO2Running = false;
                const t = translations[document.body.getAttribute('data-lang')];
                document.getElementById('co2-phase-display').textContent = t.exerciseStopped;
                document.getElementById('co2-circle').textContent = t.pause;
            }
            
            // Resetiraj Wim Hof
            resetWimHof();
        }

        // ========== JEZIƒåNE FUNKCIJE ==========
        
        function cycleLanguage() {
            const languages = [
                {code: 'hr', flag: 'üá≠üá∑', name: 'HR'},
                {code: 'en', flag: 'üá¨üáß', name: 'EN'},
                {code: 'de', flag: 'üá©üá™', name: 'DE'},
                {code: 'es', flag: 'üá™üá∏', name: 'ES'}
            ];
            
            const currentLang = document.body.getAttribute('data-lang');
            const currentIndex = languages.findIndex(lang => lang.code === currentLang);
            const nextIndex = (currentIndex + 1) % languages.length;
            const nextLang = languages[nextIndex];
            
            // Postavi novi jezik
            document.body.setAttribute('data-lang', nextLang.code);
            document.documentElement.lang = nextLang.code; // Za accessibility
            localStorage.setItem('breathing-language', nextLang.code);
            updateLanguage(nextLang.code);
            
            // A≈æuriraj gumb
            document.getElementById('current-lang-flag').textContent = nextLang.flag;
            document.getElementById('current-lang-name').textContent = nextLang.name;
            
            // Zvuƒçna povratna informacija
            playBeep(100, 600 + (nextIndex * 50));
        }

        // Funkcija za a≈æuriranje teksta na stranici
        function updateLanguage(lang) {
            const t = translations[lang];
            if (!t) return;
            
            // A≈æuriraj sve elemente
            document.getElementById('app-title').textContent = t.appTitle;
            document.getElementById('cycles-label').textContent = t.cyclesLabel;
            document.getElementById('cycles-text').textContent = t.cyclesText;
            document.getElementById('cycles-info').innerHTML = `<p>${escapeHtml(t.cyclesInfo)}</p>`;
            
            // Menu buttons
            document.getElementById('btn-deep').textContent = t.btnDeep;
            document.getElementById('btn-box').textContent = t.btnBox;
            document.getElementById('btn-alternate').textContent = t.btnAlternate;
            document.getElementById('btn-kapalabhati').textContent = t.btnKapalabhati;
            document.getElementById('btn-wimhof').textContent = t.btnWimhof;
            document.getElementById('btn-co2').textContent = t.btnCO2;
            
            // Deep Breathing
            document.getElementById('deep-title').textContent = t.deepTitle;
            document.getElementById('benefits-deep').textContent = t.benefitsDeep;
            updateList('deep-benefits-list', t.deepBenefitsList);
            document.getElementById('deep-step1').textContent = t.deepStep1;
            document.getElementById('deep-step2').textContent = t.deepStep2;
            document.getElementById('deep-step3').textContent = t.deepStep3;
            document.getElementById('deep-repeat').innerHTML = `${escapeHtml(t.deepRepeat)} <span id="deep-cycle-count">${globalCycles}</span> ${escapeHtml(t.times)}`;
            document.getElementById('btn-start-deep').textContent = t.btnStartDeep;
            
            // Box Breathing
            document.getElementById('box-title').textContent = t.boxTitle;
            document.getElementById('benefits-box').textContent = t.benefitsBox;
            updateList('box-benefits-list', t.boxBenefitsList);
            document.getElementById('box-step1').textContent = t.boxStep1;
            document.getElementById('box-step2').textContent = t.boxStep2;
            document.getElementById('box-step3').textContent = t.boxStep3;
            document.getElementById('box-step4').textContent = t.boxStep4;
            document.getElementById('box-repeat').innerHTML = `${escapeHtml(t.boxRepeat)} <span id="box-cycle-count">${globalCycles}</span> ${escapeHtml(t.times)}`;
            document.getElementById('btn-start-box').textContent = t.btnStartBox;
            
            // Alternate Breathing
            document.getElementById('alternate-title').textContent = t.alternateTitle;
            document.getElementById('benefits-alternate').textContent = t.benefitsAlternate;
            updateList('alternate-benefits-list', t.alternateBenefitsList);
            document.getElementById('alt-step1').textContent = t.altStep1;
            document.getElementById('alt-step2').textContent = t.altStep2;
            document.getElementById('alt-step3').textContent = t.altStep3;
            document.getElementById('alt-step4').textContent = t.altStep4;
            document.getElementById('alt-step5').textContent = t.altStep5;
            document.getElementById('alt-repeat').innerHTML = `${escapeHtml(t.altRepeat)} <span id="alt-cycle-count">${globalCycles}</span> ${escapeHtml(t.times)}`;
            document.getElementById('btn-start-alternate').textContent = t.btnStartAlternate;
            
            // Kapalabhati
            document.getElementById('kapalabhati-title').textContent = t.kapalabhatiTitle;
            document.getElementById('benefits-kapalabhati').textContent = t.benefitsKapalabhati;
            updateList('kapalabhati-benefits-list', t.kapalabhatiBenefitsList);
            document.getElementById('kap-step1').textContent = t.kapStep1;
            document.getElementById('kap-step2').textContent = t.kapStep2;
            document.getElementById('kap-step3').textContent = t.kapStep3;
            document.getElementById('kap-step4').textContent = t.kapStep4;
            document.getElementById('kap-repeat').innerHTML = `${escapeHtml(t.kapRepeat)} <span id="kap-cycle-count">${globalCycles}</span> ${escapeHtml(t.series)}`;
            document.getElementById('btn-start-kapalabhati').textContent = t.btnStartKapalabhati;
            
            // Wim Hof
            document.getElementById('wimhof-title').textContent = t.wimhofTitle;
            document.getElementById('benefits-wimhof').textContent = t.benefitsWimhof;
            updateList('wimhof-benefits-list', t.wimhofBenefitsList);
            
            const wimStep1Parts = t.wimStep1.split(':');
            document.getElementById('wim-step1').innerHTML = wimStep1Parts.length > 1 ? 
                `<strong>${escapeHtml(wimStep1Parts[0])}:</strong> ${escapeHtml(wimStep1Parts[1])}` : 
                escapeHtml(t.wimStep1);
            
            const wimStep2Parts = t.wimStep2.split(':');
            document.getElementById('wim-step2').innerHTML = wimStep2Parts.length > 1 ? 
                `<strong>${escapeHtml(wimStep2Parts[0])}:</strong> ${escapeHtml(wimStep2Parts[1])}` : 
                escapeHtml(t.wimStep2);
            
            const wimStep3Parts = t.wimStep3.split(':');
            document.getElementById('wim-step3').innerHTML = wimStep3Parts.length > 1 ? 
                `<strong>${escapeHtml(wimStep3Parts[0])}:</strong> ${escapeHtml(wimStep3Parts[1])}` : 
                escapeHtml(t.wimStep3);
            
            document.getElementById('wim-repeat').innerHTML = `${escapeHtml(t.wimRepeat)} <span id="wim-cycle-count">${globalCycles}</span> ${escapeHtml(t.times || 'puta')}`;
            document.getElementById('breaths-text').textContent = t.breathsText;
            document.getElementById('start-phase1').textContent = t.btnStartPhase1;
            document.getElementById('start-phase2').textContent = t.btnStartPhase2;
            document.getElementById('start-phase3').textContent = t.btnStartPhase3;
            document.getElementById('btn-reset-wimhof').textContent = t.btnResetWimhof;
            
            // CO2 Tolerance
            document.getElementById('co2-title').textContent = t.co2Title;
            document.getElementById('benefits-co2').textContent = t.benefitsCO2;
            updateList('co2-benefits-list', t.co2BenefitsList);
            
            const co2InstructionsParts = t.co2Instructions.split(':');
            document.getElementById('co2-instructions').innerHTML = co2InstructionsParts.length > 1 ? 
                `<strong>${escapeHtml(co2InstructionsParts[0])}:</strong> ${escapeHtml(co2InstructionsParts[1])}` : 
                escapeHtml(t.co2Instructions);
            
            document.getElementById('co2-tips').textContent = t.co2Tips;
            document.getElementById('inhale-label').textContent = t.inhaleLabel;
            document.getElementById('exhale-label').textContent = t.exhaleLabel;
            document.getElementById('hold-label').textContent = t.holdLabel;
            document.getElementById('inhale-duration').textContent = t.inhaleDuration;
            document.getElementById('exhale-duration').textContent = t.exhaleDuration;
            document.getElementById('hold-duration').textContent = t.holdDuration;
            document.getElementById('inhale-desc').textContent = t.inhaleDesc;
            document.getElementById('exhale-desc').textContent = t.exhaleDesc;
            document.getElementById('hold-desc').textContent = t.holdDesc;
            document.getElementById('summary-inhale-label').textContent = t.summaryInhaleLabel;
            document.getElementById('summary-exhale-label').textContent = t.summaryExhaleLabel;
            document.getElementById('summary-hold-label').textContent = t.summaryHoldLabel;
            document.getElementById('summary-cycles-label').textContent = t.summaryCyclesLabel;
            document.getElementById('btn-start-co2').textContent = t.btnStartCO2;
            
            // A≈æuriraj dinamiƒçke tekstove
            updateDynamicTexts(lang);
        }

        function updateList(elementId, items) {
            const list = document.getElementById(elementId);
            if (!list) return;
            
            list.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                list.appendChild(li);
            });
        }

        function updateDynamicTexts(lang) {
            const t = translations[lang];
            if (!t) return;
            
            // A≈æuriraj statusne tekstove u vje≈æbama ako su aktivne
            const circles = document.querySelectorAll('.circle');
            circles.forEach(circle => {
                const currentText = circle.textContent;
                
                // Provjeri svaki moguƒái tekst u svim jezicima
                const allTexts = Object.values(translations).reduce((acc, translation) => {
                    return {
                        ...acc,
                        ready: translation.ready,
                        done: translation.done,
                        inhale: translation.inhale,
                        hold: translation.hold,
                        exhale: translation.exhale,
                        pause: translation.pause,
                        fastBreathing: translation.fastBreathing,
                        breatheLeft: translation.breatheLeft,
                        breatheRight: translation.breatheRight,
                        holdEmpty: translation.holdEmpty
                    };
                }, {});
                
                // Pronaƒëi odgovarajuƒái tekst
                for (const [key, value] of Object.entries(allTexts)) {
                    if (currentText === value && t[key]) {
                        circle.textContent = t[key];
                        break;
                    }
                }
            });
            
            // A≈æuriraj brojaƒçe krugova
            const cycleCounters = document.querySelectorAll('.cycle-counter');
            cycleCounters.forEach(counter => {
                const text = counter.textContent;
                const match = text.match(/(.+):\s*(\d+)\/(\d+)/);
                if (match) {
                    const [, label, current, total] = match;
                    // Pronaƒëi odgovarajuƒái label
                    if (label.includes('Krug') || label.includes('Round') || 
                        label.includes('Runde') || label.includes('Ronda')) {
                        counter.textContent = `${t.round}: ${current}/${total}`;
                    } else if (label.includes('Serija') || label.includes('Series') || 
                               label.includes('Serie')) {
                        counter.textContent = `${t.seriesCount}: ${current}/${total}`;
                    }
                }
            });
            
            // A≈æuriraj CO2 prikaz
            const co2PhaseDisplay = document.getElementById('co2-phase-display');
            if (co2PhaseDisplay) {
                const currentText = co2PhaseDisplay.textContent;
                
                // Provjeri svaki moguƒái tekst
                const allPhaseTexts = Object.values(translations).reduce((acc, translation) => ({
                    ...acc,
                    getReady: translation.getReady,
                    start: translation.start,
                    preparation: translation.preparation,
                    exerciseComplete: translation.exerciseComplete,
                    exerciseStopped: translation.exerciseStopped
                }), {});
                
                for (const [key, value] of Object.entries(allPhaseTexts)) {
                    if (currentText.includes(value) && t[key]) {
                        co2PhaseDisplay.textContent = t[key] + 
                            (key === 'exerciseComplete' ? ' ' + t.rest : '');
                        break;
                    }
                }
            }
        }

        // XSS za≈°tita
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ========== TEME I POSTAVKE ==========
        
        function getCurrentTheme() {
            const savedTheme = localStorage.getItem('breathing-theme');
            if (savedTheme) return savedTheme;
            
            // Automatsko prepoznavanje vremena
            const now = new Date();
            const hour = now.getHours();
            const isNightTime = hour >= 20 || hour <= 6;
            
            return isNightTime ? 'dark' : 'light';
        }

        function setTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('breathing-theme', theme);
            
            // A≈æuriraj ikone
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            
            if (theme === 'dark') {
                if (sunIcon) sunIcon.textContent = 'üåô';
                if (moonIcon) moonIcon.textContent = '‚òÄÔ∏è';
            } else {
                if (sunIcon) sunIcon.textContent = '‚òÄÔ∏è';
                if (moonIcon) moonIcon.textContent = 'üåô';
            }
        }

        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            setTheme(newTheme);
            
            playBeep(100, newTheme === 'dark' ? 500 : 700);
        }

        function getCurrentLanguage() {
            const savedLang = localStorage.getItem('breathing-language');
            return savedLang || 'hr';
        }

        // ========== CYCLE COUNTER FUNCTIONS ==========
        
        function updateAllCycleCounts() {
            const cycleElements = {
                'deep-cycle-count': globalCycles,
                'box-cycle-count': globalCycles,
                'alt-cycle-count': globalCycles,
                'kap-cycle-count': globalCycles,
                'wim-cycle-count': globalCycles,
                'co2-cycle-count': globalCycles
            };
            
            for (const [id, value] of Object.entries(cycleElements)) {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            }
            
            // A≈æuriraj vrijednost pokazivaƒça
            const valueDisplay = document.getElementById('cycles-value');
            if (valueDisplay) {
                valueDisplay.textContent = globalCycles;
            }
            
            // A≈æuriraj CO2 toƒçkice
            updateCO2CycleDots();
        }

        function updateCycleCounter(counterId, cycles, totalCycles) {
            const counter = document.getElementById(counterId);
            if (!counter) return;
            
            const t = translations[document.body.getAttribute('data-lang')];
            counter.textContent = `${t.round}: ${cycles}/${totalCycles}`;
            
            if (cycles === totalCycles) {
                counter.style.backgroundColor = "var(--accent-color)";
                counter.style.borderColor = "var(--accent-color)";
            } else if (cycles > totalCycles * 0.75) {
                counter.style.backgroundColor = "var(--warning-color)";
                counter.style.borderColor = "var(--warning-color)";
            } else {
                counter.style.backgroundColor = "";
                counter.style.borderColor = "var(--primary-color)";
            }
        }

        function updateKapalabhatiCounter(cycles, totalCycles) {
            const counter = document.getElementById('kapalabhati-cycle-counter');
            if (!counter) return;
            
            const t = translations[document.body.getAttribute('data-lang')];
            counter.textContent = `${t.seriesCount}: ${cycles}/${totalCycles}`;
            
            if (cycles === totalCycles) {
                counter.style.backgroundColor = "var(--accent-color)";
                counter.style.borderColor = "var(--accent-color)";
            } else if (cycles > totalCycles * 0.75) {
                counter.style.backgroundColor = "var(--warning-color)";
                counter.style.borderColor = "var(--warning-color)";
            } else {
                counter.style.backgroundColor = "";
                counter.style.borderColor = "var(--primary-color)";
            }
        }

        function showFeedback() {
            const valueDisplay = document.getElementById('cycles-value');
            if (!valueDisplay) return;
            
            valueDisplay.style.transform = 'scale(1.3)';
            valueDisplay.style.color = 'var(--danger-color)';
            setTimeout(() => {
                valueDisplay.style.transform = 'scale(1)';
                valueDisplay.style.color = 'var(--secondary-color)';
            }, 300);
            
            playBeep(100, 600);
            updateCO2CycleDots();
        }

        // ========== UI FUNKCIJE ==========
        
        function showExercise(exerciseId) {
            // Zaustavi sve trenutne vje≈æbe
            stopAllExercises();
            
            // Sakrij sve vje≈æbe
            document.querySelectorAll('.exercise-container').forEach(div => {
                div.classList.remove('active');
            });
            
            // Prika≈æi odabranu vje≈æbu
            const exerciseElement = document.getElementById(exerciseId);
            if (exerciseElement) {
                exerciseElement.classList.add('active');
            }
        }

        // ========== CO2 FUNKCIJE ==========
        
        function adjustInhaleTime(change) {
            const slider = document.getElementById('inhale-slider');
            if (!slider) return;
            
            let newValue = parseInt(slider.value) + change;
            newValue = Math.max(parseInt(slider.min), Math.min(parseInt(slider.max), newValue));
            
            slider.value = newValue;
            co2InhaleTime = newValue;
            
            document.getElementById('inhale-value').textContent = co2InhaleTime + 's';
            document.getElementById('summary-inhale').textContent = co2InhaleTime + 's';
            
            playBeep(50, change > 0 ? 700 : 500);
        }

        function adjustExhaleTime(change) {
            const slider = document.getElementById('exhale-slider');
            if (!slider) return;
            
            let newValue = parseInt(slider.value) + change;
            newValue = Math.max(parseInt(slider.min), Math.min(parseInt(slider.max), newValue));
            
            slider.value = newValue;
            co2ExhaleTime = newValue;
            
            document.getElementById('exhale-value').textContent = co2ExhaleTime + 's';
            document.getElementById('summary-exhale').textContent = co2ExhaleTime + 's';
            
            playBeep(50, change > 0 ? 700 : 500);
        }

        function adjustHoldTime(change) {
            const slider = document.getElementById('hold-slider');
            if (!slider) return;
            
            let newValue = parseInt(slider.value) + change;
            newValue = Math.max(parseInt(slider.min), Math.min(parseInt(slider.max), newValue));
            
            slider.value = newValue;
            co2HoldTime = newValue;
            
            document.getElementById('hold-value').textContent = co2HoldTime + 's';
            document.getElementById('summary-hold').textContent = co2HoldTime + 's';
            
            playBeep(50, change > 0 ? 700 : 500);
        }

        function updateCO2CycleDots() {
            const container = document.getElementById('co2-cycle-display');
            if (!container) return;
            
            container.innerHTML = '';
            
            for (let i = 0; i < globalCycles; i++) {
                const dot = document.createElement('div');
                dot.className = 'co2-cycle-dot';
                if (i < co2Round) {
                    dot.classList.add('active');
                }
                container.appendChild(dot);
            }
        }

        function startCO2Exercise() {
            // Zaustavi ako veƒç radi
            if (isCO2Running) return;
            
            // Oƒçisti postojeƒái interval
            if (co2Interval) {
                clearInterval(co2Interval);
                co2Interval = null;
            }
            
            isCO2Running = true;
            co2Round = 0;
            
            // Resetiraj UI
            const t = translations[document.body.getAttribute('data-lang')];
            const circle = document.getElementById('co2-circle');
            const timer = document.getElementById('co2-timer');
            const progress = document.getElementById('co2-progress');
            const phaseDisplay = document.getElementById('co2-phase-display');
            
            if (circle) circle.textContent = t.ready;
            if (timer) timer.textContent = '';
            if (progress) progress.style.width = '0%';
            if (phaseDisplay) phaseDisplay.textContent = t.start;
            
            updateCO2CycleCounter();
            updateCO2CycleDots();
            
            // Pokreni prvi krug
            co2Round = 1;
            updateCO2CycleCounter();
            updateCO2CycleDots();
            startCO2Cycle();
            
            playBeep(300, 800);
        }

        function stopCO2Exercise() {
            if (!isCO2Running) return;
            
            isCO2Running = false;
            if (co2Interval) {
                clearInterval(co2Interval);
                co2Interval = null;
            }
            
            const t = translations[document.body.getAttribute('data-lang')];
            const phaseDisplay = document.getElementById('co2-phase-display');
            const circle = document.getElementById('co2-circle');
            
            if (phaseDisplay) phaseDisplay.textContent = t.exerciseStopped;
            if (circle) {
                circle.textContent = t.pause;
                circle.style.backgroundColor = 'var(--warning-color)';
            }
            
            playBeep(300, 600);
        }

        function resetCO2Exercise() {
            stopCO2Exercise();
            
            co2Round = 0;
            updateCO2CycleCounter();
            updateCO2CycleDots();
            
            const t = translations[document.body.getAttribute('data-lang')];
            const circle = document.getElementById('co2-circle');
            const timer = document.getElementById('co2-timer');
            const progress = document.getElementById('co2-progress');
            const phaseDisplay = document.getElementById('co2-phase-display');
            
            if (circle) {
                circle.textContent = t.ready;
                circle.style.backgroundColor = 'var(--co2-color)';
            }
            if (timer) timer.textContent = '';
            if (progress) progress.style.width = '0%';
            if (phaseDisplay) phaseDisplay.textContent = t.getReady;
        }

        function updateCO2CycleCounter() {
            const counter = document.getElementById('co2-cycle-counter');
            if (!counter) return;
            
            const t = translations[document.body.getAttribute('data-lang')];
            counter.textContent = `${t.round}: ${co2Round}/${globalCycles}`;
            
            if (co2Round === globalCycles) {
                counter.style.backgroundColor = "var(--accent-color)";
                counter.style.borderColor = "var(--accent-color)";
            } else if (co2Round > globalCycles * 0.75) {
                counter.style.backgroundColor = "var(--warning-color)";
                counter.style.borderColor = "var(--warning-color)";
            } else {
                counter.style.backgroundColor = "";
                counter.style.borderColor = "var(--primary-color)";
            }
        }

        function startCO2Cycle() {
            if (!isCO2Running || co2Round > globalCycles) {
                // Zavr≈°ena vje≈æba
                const t = translations[document.body.getAttribute('data-lang')];
                const phaseDisplay = document.getElementById('co2-phase-display');
                const circle = document.getElementById('co2-circle');
                
                if (phaseDisplay) phaseDisplay.textContent = t.exerciseComplete + ' ' + t.rest;
                if (circle) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = 'var(--accent-color)';
                }
                
                isCO2Running = false;
                playBeep(500, 1200);
                return;
            }
            
            const t = translations[document.body.getAttribute('data-lang')];
            const phaseDisplay = document.getElementById('co2-phase-display');
            const circle = document.getElementById('co2-circle');
            const timerElement = document.getElementById('co2-timer');
            const progressBar = document.getElementById('co2-progress');
            
            if (!phaseDisplay || !circle || !timerElement || !progressBar) return;
            
            // Faza 1: Udah
            phaseDisplay.textContent = t.inhale + ' ' + t.inhaleDesc.split('.')[0];
            circle.textContent = t.inhale;
            circle.style.backgroundColor = 'var(--accent-color)';
            
            let timeLeft = co2InhaleTime;
            timerElement.textContent = timeLeft;
            progressBar.style.width = '0%';
            
            // Oƒçisti postojeƒái interval
            if (co2Interval) {
                clearInterval(co2Interval);
            }
            
            co2Interval = setInterval(() => {
                timerElement.textContent = timeLeft;
                
                const progress = 100 - ((timeLeft - 1) / co2InhaleTime * 100);
                progressBar.style.width = `${progress}%`;
                
                if (timeLeft <= 1) {
                    clearInterval(co2Interval);
                    playBeep(300, 800);
                    
                    setTimeout(() => {
                        // Faza 2: Izdah
                        phaseDisplay.textContent = t.exhale + ' ' + t.exhaleDesc.split('.')[0];
                        circle.textContent = t.exhale;
                        circle.style.backgroundColor = 'var(--danger-color)';
                        
                        timeLeft = co2ExhaleTime;
                        timerElement.textContent = timeLeft;
                        progressBar.style.width = '0%';
                        
                        co2Interval = setInterval(() => {
                            timerElement.textContent = timeLeft;
                            
                            const progress = 100 - ((timeLeft - 1) / co2ExhaleTime * 100);
                            progressBar.style.width = `${progress}%`;
                            
                            if (timeLeft <= 1) {
                                clearInterval(co2Interval);
                                playBeep(300, 800);
                                
                                setTimeout(() => {
                                    // Faza 3: Zadr≈æavanje
                                    phaseDisplay.textContent = t.hold + ' ' + t.holdDesc.split('.')[0];
                                    circle.textContent = t.hold;
                                    circle.style.backgroundColor = 'var(--warning-color)';
                                    
                                    timeLeft = co2HoldTime;
                                    timerElement.textContent = timeLeft;
                                    progressBar.style.width = '0%';
                                    
                                    co2Interval = setInterval(() => {
                                        timerElement.textContent = timeLeft;
                                        
                                        const progress = 100 - ((timeLeft - 1) / co2HoldTime * 100);
                                        progressBar.style.width = `${progress}%`;
                                        
                                        // Zvuk za posljednjih 5 sekundi
                                        if (timeLeft <= 6 && timeLeft > 1) {
                                            playBeep(100, 600);
                                        }
                                        
                                        if (timeLeft <= 1) {
                                            clearInterval(co2Interval);
                                            playBeep(500, 800);
                                            
                                            updateCO2CycleDots();

                                            // Sljedeƒái krug
                                            if (co2Round < globalCycles) {
                                                co2Round++;
                                                updateCO2CycleCounter();
                                                
                                                setTimeout(() => {
                                                    startCO2Cycle();
                                                }, 200);
                                            } 
                                            else {
                                                // Zavr≈°ena cijela vje≈æba
                                                phaseDisplay.textContent = t.exerciseComplete + ' ' + t.rest;
                                                circle.textContent = t.done;
                                                circle.style.backgroundColor = 'var(--accent-color)';
                                                timerElement.textContent = '';
                                                progressBar.style.width = '0%';
                                                isCO2Running = false;
                                            }
                                        }
                                        timeLeft--;
                                    }, 1000);
                                }, 200);
                            }
                            timeLeft--;
                        }, 1000);
                    }, 200);
                }
                timeLeft--;
            }, 1000);
        }

        // ========== WIM HOF FUNKCIJE ==========
        
        function resetWimHof() {
            wimhofRound = 0;
            wimhofPhase = 0;
            breathCount = 0;
            
            // Oƒçisti sve timere
            if (phase1Timer) {
                clearInterval(phase1Timer);
                phase1Timer = null;
            }
            if (phase2Timer) {
                clearInterval(phase2Timer);
                phase2Timer = null;
            }
            if (phase3Timer) {
                clearTimeout(phase3Timer);
                phase3Timer = null;
            }
            
            // Resetiraj UI
            const t = translations[document.body.getAttribute('data-lang')];
            const phaseElement = document.getElementById('wimhof-phase');
            const circle = document.getElementById('wimhof-circle');
            
            if (phaseElement) phaseElement.textContent = t.preparation;
            if (circle) {
                circle.textContent = t.ready;
                circle.style.backgroundColor = 'var(--danger-color)';
            }
            
            document.getElementById('breath-counter').style.display = 'none';
            document.getElementById('wimhof-timer').style.display = 'none';
            document.getElementById('hold-timer').style.display = 'none';
            
            const progressBar = document.getElementById('wimhof-progress');
            if (progressBar) progressBar.style.width = '0%';
            
            // Resetiraj gumbe
            document.getElementById('start-phase1').style.display = 'block';
            document.getElementById('start-phase2').style.display = 'none';
            document.getElementById('start-phase3').style.display = 'none';
            
            // A≈æuriraj brojaƒç krugova
            updateCycleCounter('wimhof-cycle-counter', 0, globalCycles);
        }

        function updateWimhofCycleCounter() {
            updateCycleCounter('wimhof-cycle-counter', wimhofRound, globalCycles);
        }

        function startWimHofPhase1() {
            // Oƒçisti postojeƒáe timere
            if (phase1Timer) clearInterval(phase1Timer);
            if (phase2Timer) clearInterval(phase2Timer);
            if (phase3Timer) clearTimeout(phase3Timer);
            
            if (wimhofRound >= globalCycles) {
                const t = translations[document.body.getAttribute('data-lang')];
                const phaseElement = document.getElementById('wimhof-phase');
                const circle = document.getElementById('wimhof-circle');
                
                if (phaseElement) phaseElement.textContent = t.exerciseComplete;
                if (circle) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = 'var(--accent-color)';
                }
                playBeep(500, 1200);
                return;
            }
            
            wimhofRound++;
            updateWimhofCycleCounter();
            
            wimhofPhase = 1;
            breathCount = 0;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            // A≈æuriraj UI
            const phaseElement = document.getElementById('wimhof-phase');
            const circle = document.getElementById('wimhof-circle');
            
            if (phaseElement) phaseElement.textContent = t.wimStep1;
            if (circle) {
                circle.textContent = t.fastBreathing;
                circle.style.backgroundColor = 'var(--primary-color)';
            }
            
            document.getElementById('breath-counter').style.display = 'block';
            document.getElementById('breath-count').textContent = '0';
            document.getElementById('wimhof-timer').style.display = 'block';
            document.getElementById('wimhof-timer').textContent = '60';
            document.getElementById('hold-timer').style.display = 'none';
            
            // Sakrij/poka≈æi gumbe
            document.getElementById('start-phase1').style.display = 'none';
            document.getElementById('start-phase2').style.display = 'block';
            document.getElementById('start-phase3').style.display = 'none';
            
            // Pokreni tajmer za 60 sekundi
            let timeLeft = 60;
            const timerElement = document.getElementById('wimhof-timer');
            const progressBar = document.getElementById('wimhof-progress');
            
            if (!timerElement || !progressBar) return;
            
            phase1Timer = setInterval(() => {
                timerElement.textContent = timeLeft;
                
                const progress = 100 - ((timeLeft - 1) / 60 * 100);
                progressBar.style.width = `${progress}%`;
                
                if (timeLeft <= 1) {
                    clearInterval(phase1Timer);
                    // Automatski prelazi u fazu 2 nakon 60 sekundi
                    startWimHofPhase2();
                }
                timeLeft--;
            }, 1000);
            
            playBeep(300, 800);
        }

        function startWimHofPhase2() {
            if (phase1Timer) {
                clearInterval(phase1Timer);
                phase1Timer = null;
            }
            
            wimhofPhase = 2;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            // A≈æuriraj UI
            const phaseElement = document.getElementById('wimhof-phase');
            const circle = document.getElementById('wimhof-circle');
            
            if (phaseElement) phaseElement.textContent = t.wimStep2;
            if (circle) {
                circle.textContent = t.hold;
                circle.style.backgroundColor = 'var(--danger-color)';
            }
            
            document.getElementById('breath-counter').style.display = 'none';
            document.getElementById('wimhof-timer').style.display = 'none';
            document.getElementById('hold-timer').style.display = 'block';
            document.getElementById('hold-timer').textContent = '00:00';
            
            // Sakrij/poka≈æi gumbe
            document.getElementById('start-phase1').style.display = 'none';
            document.getElementById('start-phase2').style.display = 'none';
            document.getElementById('start-phase3').style.display = 'block';
            
            // Pokreni stopwatch za zadr≈æavanje daha
            phase2StartTime = Date.now();
            phase2Timer = setInterval(() => {
                const elapsed = Math.floor((Date.now() - phase2StartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                const holdTimer = document.getElementById('hold-timer');
                if (holdTimer) {
                    holdTimer.textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 100);
            
            playBeep(300, 600);
        }

        function startWimHofPhase3() {
            if (phase2Timer) {
                clearInterval(phase2Timer);
                phase2Timer = null;
            }
            
            wimhofPhase = 3;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            // A≈æuriraj UI
            const phaseElement = document.getElementById('wimhof-phase');
            const circle = document.getElementById('wimhof-circle');
            
            if (phaseElement) phaseElement.textContent = t.wimStep3;
            if (circle) {
                circle.textContent = t.inhale + ' ' + t.hold;
                circle.style.backgroundColor = 'var(--primary-color)';
            }
            
            document.getElementById('hold-timer').style.display = 'block';
            document.getElementById('hold-timer').textContent = '15';
            
            // Sakrij/poka≈æi gumbe
            document.getElementById('start-phase1').style.display = 'block';
            document.getElementById('start-phase2').style.display = 'none';
            document.getElementById('start-phase3').style.display = 'none';
            
            // Pokreni tajmer od 15 sekundi
            let timeLeft = 15;
            const holdTimerElement = document.getElementById('hold-timer');
            const progressBar = document.getElementById('wimhof-progress');
            
            if (!holdTimerElement || !progressBar) return;
            
            // Resetiraj progress bar
            progressBar.style.width = '0%';
            
            phase3Timer = setInterval(() => {
                holdTimerElement.textContent = timeLeft;
                
                const progress = 100 - ((timeLeft - 1) / 15 * 100);
                progressBar.style.width = `${progress}%`;
                
                if (timeLeft <= 1) {
                    clearInterval(phase3Timer);
                    
                    playBeep(500, 1200);
                    
                    const t = translations[document.body.getAttribute('data-lang')];
                    
                    // Ako imamo jo≈° krugova, pripremi za sljedeƒái
                    if (wimhofRound < globalCycles) {
                        setTimeout(() => {
                            const phaseElement = document.getElementById('wimhof-phase');
                            const circle = document.getElementById('wimhof-circle');
                            
                            if (phaseElement) phaseElement.textContent = t.preparation;
                            if (circle) {
                                circle.textContent = t.ready;
                                circle.style.backgroundColor = 'var(--danger-color)';
                            }
                            
                            document.getElementById('hold-timer').style.display = 'none';
                            progressBar.style.width = '0%';
                            
                            setTimeout(() => {
                                startWimHofPhase1();
                            }, 1000);
                        }, 500);
                    } else {
                        // Zavr≈°ena cijela vje≈æba
                        const phaseElement = document.getElementById('wimhof-phase');
                        const circle = document.getElementById('wimhof-circle');
                        
                        if (phaseElement) phaseElement.textContent = t.exerciseComplete + ' ' + t.rest;
                        if (circle) {
                            circle.textContent = t.done;
                            circle.style.backgroundColor = 'var(--accent-color)';
                        }
                        
                        document.getElementById('hold-timer').style.display = 'none';
                        document.getElementById('start-phase1').style.display = 'none';
                    }
                }
                timeLeft--;
            }, 1000);
            
            playBeep(300, 800);
        }

        // ========== OSTATALI VJE≈ΩBE ==========
        
        // Pomoƒána funkcija za animaciju
        function animateProgress(duration, timerId, callback) {
            const timer = document.getElementById(timerId);
            const progressBarId = timerId.replace('timer', 'progress');
            const bar = document.getElementById(progressBarId);
            
            if (!timer || !bar) return;
            
            let timeLeft = duration;
            const interval = setInterval(() => {
                timer.textContent = timeLeft;
                const progress = 100 - ((timeLeft - 1) / duration * 100);
                bar.style.width = `${progress}%`;
                
                if (timeLeft <= 1) {
                    clearInterval(interval);
                    bar.style.width = "0%";
                    if (callback) callback();
                }
                timeLeft--;
            }, 1000);
            
            // Spremi interval za ƒçi≈°ƒáenje
            activeIntervals.push(interval);
        }

        // DUBOKO DISANJE
        function startDeepBreathing() {
            clearAllIntervals();
            
            const circle = document.getElementById('deep-circle');
            const timer = document.getElementById('deep-timer');
            const progressBar = document.getElementById('deep-progress');
            
            if (!circle || !timer || !progressBar) return;
            
            let cycles = 0;
            const totalCycles = globalCycles;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            cycles = 0;
            progressBar.style.width = "0%";
            circle.textContent = t.ready;
            circle.style.backgroundColor = "var(--danger-color)";
            
            updateCycleCounter('deep-cycle-counter', 0, totalCycles);
            
            function deepBreathCycle() {
                if (cycles >= totalCycles) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = "var(--accent-color)";
                    timer.textContent = "";
                    updateCycleCounter('deep-cycle-counter', totalCycles, totalCycles);
                    playBeep(500, 1200);
                    return;
                }
                
                cycles++;
                updateCycleCounter('deep-cycle-counter', cycles, totalCycles);
                
                circle.textContent = t.inhale;
                circle.style.backgroundColor = "var(--primary-color)";
                animateProgress(4, "deep-timer", () => {
                    playBeep(300, 800);
                    circle.textContent = t.hold;
                    circle.style.backgroundColor = "#9b59b6";
                    animateProgress(7, "deep-timer", () => {
                        playBeep(300, 800);
                        circle.textContent = t.exhale;
                        circle.style.backgroundColor = "var(--danger-color)";
                        animateProgress(8, "deep-timer", () => {
                            playBeep(300, 800);
                            setTimeout(deepBreathCycle, 300);
                        });
                    });
                });
            }
            
            deepBreathCycle();
        }

        // KVADRATNO DISANJE
        function startBoxBreathing() {
            clearAllIntervals();
            
            const circle = document.getElementById('box-circle');
            const timer = document.getElementById('box-timer');
            const progressBar = document.getElementById('box-progress');
            
            if (!circle || !timer || !progressBar) return;
            
            let cycles = 0;
            const totalCycles = globalCycles;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            cycles = 0;
            progressBar.style.width = "0%";
            circle.textContent = t.ready;
            circle.style.backgroundColor = "var(--danger-color)";
            
            updateCycleCounter('box-cycle-counter', 0, totalCycles);
            
            function boxBreathCycle() {
                if (cycles >= totalCycles) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = "var(--accent-color)";
                    timer.textContent = "";
                    updateCycleCounter('box-cycle-counter', totalCycles, totalCycles);
                    playBeep(500, 1200);
                    return;
                }
                
                cycles++;
                updateCycleCounter('box-cycle-counter', cycles, totalCycles);
                
                circle.textContent = t.inhale;
                circle.style.backgroundColor = "var(--primary-color)";
                animateProgress(4, "box-timer", () => {
                    playBeep(300, 800);
                    circle.textContent = t.hold;
                    circle.style.backgroundColor = "#9b59b6";
                    animateProgress(4, "box-timer", () => {
                        playBeep(300, 800);
                        circle.textContent = t.exhale;
                        circle.style.backgroundColor = "var(--danger-color)";
                        animateProgress(4, "box-timer", () => {
                            playBeep(300, 800);
                            circle.textContent = t.holdEmpty;
                            circle.style.backgroundColor = "var(--warning-color)";
                            animateProgress(4, "box-timer", () => {
                                playBeep(300, 800);
                                setTimeout(boxBreathCycle, 300);
                            });
                        });
                    });
                });
            }
            
            boxBreathCycle();
        }

        // ALTERNATIVNO DISANJE
        function startAlternateBreathing() {
            clearAllIntervals();
            
            const circle = document.getElementById('alternate-circle');
            const timer = document.getElementById('alternate-timer');
            const progressBar = document.getElementById('alternate-progress');
            
            if (!circle || !timer || !progressBar) return;
            
            let cycles = 0;
            const totalCycles = globalCycles;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            cycles = 0;
            progressBar.style.width = "0%";
            circle.textContent = t.ready;
            circle.style.backgroundColor = "var(--danger-color)";
            
            updateCycleCounter('alternate-cycle-counter', 0, totalCycles);
            
            function alternateBreathCycle() {
                if (cycles >= totalCycles) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = "var(--accent-color)";
                    timer.textContent = "";
                    updateCycleCounter('alternate-cycle-counter', totalCycles, totalCycles);
                    playBeep(500, 1200);
                    return;
                }
                
                cycles++;
                updateCycleCounter('alternate-cycle-counter', cycles, totalCycles);
                
                circle.textContent = t.breatheLeft;
                circle.style.backgroundColor = "var(--primary-color)";
                animateProgress(4, "alternate-timer", () => {
                    playBeep(300, 800);
                    circle.textContent = t.hold;
                    circle.style.backgroundColor = "#9b59b6";
                    animateProgress(4, "alternate-timer", () => {
                        playBeep(300, 800);
                        circle.textContent = t.breatheRight;
                        circle.style.backgroundColor = "var(--danger-color)";
                        animateProgress(6, "alternate-timer", () => {
                            playBeep(300, 800);
                            setTimeout(alternateBreathCycle, 300);
                        });
                    });
                });
            }
            
            alternateBreathCycle();
        }

        // KAPALABHATI
        function startKapalabhati() {
            clearAllIntervals();
            
            const circle = document.getElementById('kapalabhati-circle');
            const timer = document.getElementById('kapalabhati-timer');
            const progressBar = document.getElementById('kapalabhati-progress');
            
            if (!circle || !timer || !progressBar) return;
            
            let rounds = 0;
            const totalRounds = globalCycles;
            
            const t = translations[document.body.getAttribute('data-lang')];
            
            rounds = 0;
            progressBar.style.width = "0%";
            circle.textContent = t.ready;
            circle.style.backgroundColor = "var(--danger-color)";
            
            updateKapalabhatiCounter(0, totalRounds);
            
            function round() {
                if (rounds >= totalRounds) {
                    circle.textContent = t.done;
                    circle.style.backgroundColor = "var(--accent-color)";
                    timer.textContent = "";
                    updateKapalabhatiCounter(totalRounds, totalRounds);
                    playBeep(500, 1200);
                    return;
                }
                
                rounds++;
                updateKapalabhatiCounter(rounds, totalRounds);
                
                circle.textContent = t.fastBreathing;
                circle.style.backgroundColor = "var(--danger-color)";
                animateProgress(15, "kapalabhati-timer", () => {
                    playBeep(300, 800);
                    circle.textContent = t.inhale + ' ' + t.hold;
                    circle.style.backgroundColor = "#9b59b6";
                    animateProgress(15, "kapalabhati-timer", () => {
                        playBeep(300, 800);
                        setTimeout(round, 300);
                    });
                });
            }
            
            round();
        }

        // ========== INICIJALIZACIJA ==========
        
        window.onload = function() {
            // Postavi temu
            const initialTheme = getCurrentTheme();
            setTheme(initialTheme);
            
            // Postavi jezik
            const initialLang = getCurrentLanguage();
            document.body.setAttribute('data-lang', initialLang);
            document.documentElement.lang = initialLang;
            updateLanguage(initialLang);
            
            // Inicijaliziraj gumb za jezik
            const languages = [
                {code: 'hr', flag: 'üá≠üá∑', name: 'HR'},
                {code: 'en', flag: 'üá¨üáß', name: 'EN'},
                {code: 'de', flag: 'üá©üá™', name: 'DE'},
                {code: 'es', flag: 'üá™üá∏', name: 'ES'}
            ];
            const initialLangObj = languages.find(lang => lang.code === initialLang);
            if (initialLangObj) {
                const flagElement = document.getElementById('current-lang-flag');
                const nameElement = document.getElementById('current-lang-name');
                
                if (flagElement) flagElement.textContent = initialLangObj.flag;
                if (nameElement) nameElement.textContent = initialLangObj.name;
            }
            
            // Postavi poƒçetnu vrijednost slidera
            const slider = document.getElementById('global-cycles');
            if (slider) {
                slider.value = globalCycles;
                updateAllCycleCounts();
                
                // Dodaj event listener na slider
                slider.addEventListener('input', function() {
                    globalCycles = parseInt(this.value);
                    updateAllCycleCounts();
                    showFeedback();
                });
            }
            
            // CO2 slider event listeneri
            const inhaleSlider = document.getElementById('inhale-slider');
            if (inhaleSlider) {
                inhaleSlider.addEventListener('input', function() {
                    co2InhaleTime = parseInt(this.value);
                    document.getElementById('inhale-value').textContent = co2InhaleTime + 's';
                    document.getElementById('summary-inhale').textContent = co2InhaleTime + 's';
                    playBeep(50, 600);
                });
            }
            
            const exhaleSlider = document.getElementById('exhale-slider');
            if (exhaleSlider) {
                exhaleSlider.addEventListener('input', function() {
                    co2ExhaleTime = parseInt(this.value);
                    document.getElementById('exhale-value').textContent = co2ExhaleTime + 's';
                    document.getElementById('summary-exhale').textContent = co2ExhaleTime + 's';
                    playBeep(50, 600);
                });
            }
            
            const holdSlider = document.getElementById('hold-slider');
            if (holdSlider) {
                holdSlider.addEventListener('input', function() {
                    co2HoldTime = parseInt(this.value);
                    document.getElementById('hold-value').textContent = co2HoldTime + 's';
                    document.getElementById('summary-hold').textContent = co2HoldTime + 's';
                    playBeep(50, 600);
                });
            }
            
            // Inicijaliziraj CO2 prikaz toƒçkica
            updateCO2CycleDots();
            
            // Prika≈æi prvu vje≈æbu po defaultu
            showExercise('deep');
            
            // Dodaj event listener za inicijalizaciju AudioContexta
            document.addEventListener('click', function initAudio() {
                if (!audioInitialized) {
                    getAudioContext();
                }
                document.removeEventListener('click', initAudio);
            });
        };

        // Dodaj event listener za tipkovnicu (accessibility)
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                stopAllExercises();
            }
        });
    </script>
</body>
</html>
